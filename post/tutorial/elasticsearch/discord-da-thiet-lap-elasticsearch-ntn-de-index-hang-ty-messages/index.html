<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#ffffff"><title>Discord Ä‘Ã£ thiáº¿t láº­p Elasticsearch nhÆ° tháº¿ nÃ o Ä‘á»ƒ cÃ³ thá»ƒ index hÃ ng tá»· messages? - We Are No Dev</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content="Discord tuy sinh sau Ä‘áº» muá»™n so vá»›i cÃ¡c Ã´ng lá»›n khÃ¡c nhÆ°ng lÃ  má»™t trong nhá»¯ng á»©ng dá»¥ng chat Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i, Ä‘áº·c biá»‡t trong gaming. Má»™t Ä‘iá»u thÃº vá»‹ lÃ  á»Ÿ Discord, há» sá»­ dá»¥ng Elasticsearch cho viá»‡c index vÃ  search cÃ¡c messages. Váº­y Discord Ä‘Ã£ index hÃ ng tá»· messages cá»§a há» nhÆ° tháº¿ nÃ o?"><meta property="og:title" content="Discord Ä‘Ã£ thiáº¿t láº­p Elasticsearch nhÆ° tháº¿ nÃ o Ä‘á»ƒ cÃ³ thá»ƒ index hÃ ng tá»· messages?"><meta property="og:description" content="Discord tuy sinh sau Ä‘áº» muá»™n so vá»›i cÃ¡c Ã´ng lá»›n khÃ¡c nhÆ°ng lÃ  má»™t trong nhá»¯ng á»©ng dá»¥ng chat Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i, Ä‘áº·c biá»‡t trong gaming. Má»™t Ä‘iá»u thÃº vá»‹ lÃ  á»Ÿ Discord, há» sá»­ dá»¥ng Elasticsearch cho viá»‡c index vÃ  search cÃ¡c messages. Váº­y Discord Ä‘Ã£ index hÃ ng tá»· messages cá»§a há» nhÆ° tháº¿ nÃ o?"><meta property="og:type" content="article"><meta property="og:url" content="/post/tutorial/elasticsearch/discord-da-thiet-lap-elasticsearch-ntn-de-index-hang-ty-messages/"><meta property="article:published_time" content="2020-09-23T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-23T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Discord Ä‘Ã£ thiáº¿t láº­p Elasticsearch nhÆ° tháº¿ nÃ o Ä‘á»ƒ cÃ³ thá»ƒ index hÃ ng tá»· messages?"><meta name=twitter:description content="Discord tuy sinh sau Ä‘áº» muá»™n so vá»›i cÃ¡c Ã´ng lá»›n khÃ¡c nhÆ°ng lÃ  má»™t trong nhá»¯ng á»©ng dá»¥ng chat Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i, Ä‘áº·c biá»‡t trong gaming. Má»™t Ä‘iá»u thÃº vá»‹ lÃ  á»Ÿ Discord, há» sá»­ dá»¥ng Elasticsearch cho viá»‡c index vÃ  search cÃ¡c messages. Váº­y Discord Ä‘Ã£ index hÃ ng tá»· messages cá»§a há» nhÆ° tháº¿ nÃ o?"><link rel=icon type=image/png href=/favicon.png><link rel=apple-touch-icon href=/favicon.png><meta name=msapplication-TileImage content="/favicon.png"><link href="https://fonts.googleapis.com/css2?family=Muli:ital,wght@0,400;0,500;0,700;0,800;1,400&display=swap" rel=stylesheet><link href=/vendor/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet><link rel=stylesheet href=/css/style.min.3593336bd12106f4ab3d37ce2fd3db6b.css integrity="md5-NZMza9EhBvSrPTfOL9Pbaw=="><link rel=stylesheet href=/css/spacing_helpers.min.css><link rel=stylesheet href=/css/custom.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-162061519-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class=logo><a href=/ title="We Are No Dev" rel=home><img src=/favicon.png alt="We Are No Dev" class=header__favicon></a>
<a class=logo__link href=/ title="We Are No Dev" rel=home><div class=logo__title>We Are No Dev</div><div class=logo__tagline>We are NOT ONLY Developers</div></a><img src=/img/outline-banner.png alt="We Are No Dev" class=header__banner_img></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Discord Ä‘Ã£ thiáº¿t láº­p Elasticsearch nhÆ° tháº¿ nÃ o Ä‘á»ƒ cÃ³ thá»ƒ index hÃ ng tá»· messages?</h1><div class="post__meta meta"><div class="meta__item meta__item-lang"><i class=meta__icon><img src=/icon/vi64.png alt=vi width=16px></i>
<span class=meta__text>Vietnamese</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-09-23T00:00:00Z>Sep 23, 2020</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/elasticsearch-tutorial/ rel=category>Elasticsearch Tutorial</a></span></div></div></header><div class="post__toc toc toc_mobile"><div class=toc__title>Table of contents</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#1-overview>1. Overview</a><ul><li><a href=#11-server--channel--message>1.1. Server / Channel / Message</a></li><li><a href=#12-database>1.2. Database</a></li></ul></li><li><a href=#2-how-discord-setup-elasticsearch>2. How Discord setup Elasticsearch?</a><ul><li><a href=#21-indexing>2.1. Indexing</a></li><li><a href=#22-discord-sharding>2.2. Discord Sharding</a></li><li><a href=#23-search>2.3. Search</a></li><li><a href=#24-cluster-size>2.4. Cluster Size</a></li></ul></li><li><a href=#3-conclusion>3. Conclusion</a></li></ul></nav></div></div><div class="content post__content clearfix"><p><strong><a href=https://discord.com/>Discord</a></strong> tuy <em>sinh sau Ä‘áº» muá»™n</em> so vá»›i cÃ¡c Ã´ng lá»›n khÃ¡c nhÆ°ng lÃ  má»™t trong nhá»¯ng á»©ng dá»¥ng chat Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i, Ä‘áº·c biá»‡t trong gaming. Má»™t Ä‘iá»u thÃº vá»‹ lÃ  á»Ÿ Discord, há» sá»­ dá»¥ng <a href=https://www.elastic.co/>Elasticsearch</a> cho viá»‡c <em>index</em> vÃ  <em>search</em> cÃ¡c messages. Váº­y Discord Ä‘Ã£ index <em>hÃ ng tá»· messages</em> cá»§a há» nhÆ° tháº¿ nÃ o?</p><div class="center m-t-20 m-b-20"><img src=/img/background/discord-bg.png alt width=600px decoding=async></div><p>Trong quÃ¡ trÃ¬nh mÃ¬nh tÃ¬m hiá»ƒu vá» Elasticsearch, mÃ¬nh Ä‘Ã£ Ä‘á»c qua <a href=https://blog.discord.com/how-discord-indexes-billions-of-messages-e3d5e9be866f>bÃ i viáº¿t nÃ y</a> cá»§a Discord, chia sáº» vá» cÃ¡ch mÃ  há» thá»±c hiá»‡n index hÃ ng tá»· messages nháº±m phá»¥c vá»¥ chá»©c nÄƒng tÃ¬m kiáº¿m (search) messages trong group. BÃ i viáº¿t <a href=https://blog.discord.com/how-discord-indexes-billions-of-messages-e3d5e9be866f>How Discord Indexes Billions of Messages</a> Ä‘Æ°á»£c chia sáº» á»Ÿ Ä‘áº§u nÄƒm 2017, tá»©c khoáº£ng 2 nÄƒm sau khi Discord release (Discord release vÃ o nÄƒm 2015).</p><h2 id=1-overview>1. Overview</h2><h3 id=11-server--channel--message>1.1. Server / Channel / Message</h3><p>Äáº§u tiÃªn mÃ¬nh muá»‘n lÃ m rÃµ vá» há»‡ thá»‘ng lÆ°u trá»¯ ngÆ°á»i dÃ¹ng, group vÃ  message á»Ÿ Discord. Discord lÆ°u trá»¯ messages ngÆ°á»i dÃ¹ng á»Ÿ 3 layer (3 lá»›p lÆ°u trá»¯). Cá»¥ thá»ƒ khÃ¡i niá»‡m <strong>group</strong> á»Ÿ Discord Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ  <strong>server</strong> hay <strong>guide</strong>. Khi ngÆ°á»i dÃ¹ng tham gia vÃ o Discord, há» sáº½ cÃ³ thá»ƒ táº¡o ra cÃ¡c group (server) riÃªng mÃ  há» muá»‘n, vÃ  thá»±c hiá»‡n má»i báº¡n bÃ¨ gia nháº­p.</p><p>Trong má»—i server, Discord chia ra thÃ nh nhiá»u <strong>channel</strong>, á»Ÿ má»©c channel nÃ y, ngÆ°á»i dÃ¹ng má»›i cÃ³ thá»ƒ thá»±c hiá»‡n chat vá»›i nhau, tá»©c gá»­i message. Do váº­y, message á»Ÿ Discord Ä‘Æ°á»£c lÆ°u trá»¯ á»Ÿ táº§ng channel thay vÃ¬ táº§ng server.</p><p>MÃ´ hÃ¬nh lÆ°u trá»¯ messages nÃ y Ä‘Æ°á»£c minh há»a nhÆ° hÃ¬nh bÃªn dÆ°á»›i</p><div class="center m-t-20 m-b-20"><img src=/img/post/elasticsearch/discord/discord-server-channel-message.jpg alt width=400px decoding=async></div><h3 id=12-database>1.2. Database</h3><p>Váº¥n Ä‘á» tiáº¿p theo mÃ  mÃ¬nh muá»‘n Ä‘á» cáº­p chÃ­nh lÃ  lÆ°u trá»¯ messages á»Ÿ Discord nhÆ° tháº¿ nÃ o. Theo <a href=https://blog.discord.com/how-discord-stores-billions-of-messages-7fa6ec7ee4c7>bÃ i viáº¿t</a> cÅ©ng do Discord chia sáº», <a href=https://blog.discord.com/how-discord-stores-billions-of-messages-7fa6ec7ee4c7>How Discord Stores Billions of Messages</a>, há» lÆ°u trá»¯ messages dÃ¹ng cÆ¡ sá»Ÿ dá»¯ liá»‡u <a href=https://cassandra.apache.org/>Cassandra</a>.</p><p>Theo nhÆ° Discord chia sáº», há» Ä‘Ã£ chuyá»ƒn tá»« MongoDB sang Cassandra Ä‘á»ƒ scale há»‡ thá»‘ng khi mÃ  lÆ°á»£ng messages Ä‘Ã£ tÄƒng lÃªn quÃ¡ nhanh.</p><h2 id=2-how-discord-setup-elasticsearch>2. How Discord setup Elasticsearch?</h2><h3 id=21-indexing>2.1. Indexing</h3><p>Viá»‡c index messages á»Ÿ Discord Ä‘Æ°á»£c thá»±c hiá»‡n theo mÃ´ hÃ¬nh dÆ°á»›i Ä‘Ã¢y:</p><ul><li>Sá»­ dá»¥ng má»™t sá»‘ worker Ä‘á»ƒ index cÃ¡c messages cÅ© tá»« database, gá»i lÃ  <strong>Historical Index Worker</strong>. Má»™t lÆ°u Ã½ á»Ÿ bÆ°á»›c nÃ y chÃ­nh lÃ  tÃ­nh <strong>iterable</strong>. Discord sá»­ dá»¥ng database lÃ  <strong>Cassandra</strong> vÃ  cÃ³ kháº£ nÄƒng iterate cÃ¡c messages cÅ© má»™t cÃ¡ch hiá»‡u quáº£ mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n performace hiá»‡n táº¡i cá»§a há»‡ thá»‘ng.</li><li>Sá»­ dá»¥ng cÃ¡c worker khÃ¡c thá»±c hiá»‡n index cÃ¡c messages má»›i tá»« ngÆ°á»i dÃ¹ng báº±ng <strong>Message Queue</strong>. Message Queue khÃ´ng Ä‘Æ°á»£c Discord Ä‘á» cáº­p trong bÃ i viáº¿t, tuy nhiÃªn chÃºng ta cÃ³ thá»ƒ thay thá»ƒ hoáº·c tin tÆ°á»Ÿng vÃ o <a href=https://kafka.apache.org/>Kafka</a> hoáº·c <a href=https://www.rabbitmq.com/>RabbitMQ</a>.</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/elasticsearch/discord/discord-indexing.jpg alt width=80% decoding=async></div><p>ThÃªm má»™t Ä‘iá»u ná»¯a lÃ  Discord tuÃ¢n theo triáº¿t lÃ½ <strong>Lazily Indexed</strong>, tá»©c khÃ´ng thá»±c hiá»‡n index náº¿u khÃ´ng cÃ³ hÃ nh Ä‘á»™ng search tá»« ngÆ°á»i dÃ¹ng. Viá»‡c nÃ y Ä‘áº£m báº£o nhá»¯ng gÃ¬ Ä‘Æ°á»£c index lÃ  nhá»¯ng gÃ¬ Ä‘Æ°á»£c search.</p><h3 id=22-discord-sharding>2.2. Discord Sharding</h3><p>Viá»‡c <strong>sharding</strong> á»Ÿ Discord lÃ  má»™t <strong>tinh hoa</strong> trong bÃ i viáº¿t mÃ  há» chia sáº». Tuy nÃ³ khÃ´ng háº³n phÃ¹ há»£p trong má»i ngá»¯ cáº£nh nhÆ°ng Ä‘Ã³ lÃ  má»™t thiáº¿t káº¿ chÃºng ta cÃ³ thá»ƒ há»c há»i vÃ  tiáº¿p thu.</p><h4 id=221-shard-definition>2.2.1. Shard Definition</h4><p>NhÆ° chÃºng ta biáº¿t, <strong>Elasticsearch</strong> thá»±c hiá»‡n sharding cÃ¡c index ra nhiá»u <strong>primary shards</strong>, má»—i primary shards cÃ³ thá»ƒ Ä‘Æ°á»£c <strong>replicated</strong> hoáº·c khÃ´ng tÃ¹y má»¥c Ä‘Ã­ch sá»­ dá»¥ng cá»§a ngÆ°á»i dÃ¹ng. Má»—i index sáº½ Ä‘Æ°á»£c sharding ra nhiá»u shard dá»±a trÃªn má»™t <strong>routing key</strong>, mÃ  máº·c Ä‘á»‹nh chÃ­nh lÃ  <strong>docID</strong>. Má»¥c tiÃªu sá»­ dá»¥ng Elasticsearch á»Ÿ Discord chÃ­nh lÃ  <em>search messages</em> theo tá»«ng <em>group</em> (hay <em>server</em>). Do Ä‘Ã³ náº¿u sá»­ dá»¥ng sharding tá»« Elasticsearch, chÃºng ta cÃ³ thá»ƒ nghÄ© Ä‘áº¿n viá»‡c sá»­ dá»¥ng <strong>groupID</strong> (<strong>serverID</strong>) lÃ m <em>routing key</em>, tá»« Ä‘Ã³ Ä‘áº£m báº£o má»i messages trong má»™t group sáº½ náº±m trÃªn má»™t shard nháº¥t Ä‘á»‹nh.</p><p>á» Discord, khÃ¡i niá»‡m Shard Ä‘Ã£ Ä‘Æ°á»£c thay Ä‘á»•i, khÃ´ng sá»­ dá»¥ng cÆ¡ cháº¿ sharding nhÆ° Elasticsearch. Há» thá»±c hiá»‡n <strong>sharding á»Ÿ táº§ng application</strong>. Má»—i má»™t shard á»Ÿ Discord tÆ°Æ¡ng á»©ng lÃ  má»™t cáº·p <strong>Cluster - Index</strong>, tÆ°Æ¡ng á»©ng vá»›i cluster vÃ  index trÃªn cluster Ä‘Ã³. LÃºc nÃ y, index cá»§a há» chá»‰ sá»­ dá»¥ng <em>1 primary shards</em> duy nháº¥t, Ä‘iá»u Ä‘Ã³ Ä‘áº£m báº£o sharding cá»§a há» cÃ³ Ã½ nghÄ©a.</p><p>CÆ¡ cháº¿ sharding cÃ³ há» Ä‘Æ°á»£c thá»±c hiá»‡n nhÆ° sau:</p><ul><li>Mapping tÆ°Æ¡ng á»©ng má»—i má»™t <strong>groupID</strong> vá»›i má»™t cáº·p <strong>Cluster - Index</strong>.</li><li><strong>Persistent Shard Mapping</strong>: sá»­ dá»¥ng má»™t database Ä‘á»ƒ thá»±c hiá»‡n mapping. Cá»¥ thá»ƒ dÃ¹ng cassandra Ä‘á»ƒ lÆ°u persist viá»‡c mapping.</li><li><strong>Shard Mapping Cache</strong>: dÃ¹ng <strong>Redis</strong> cache viá»‡c mapping, nháº±m speed up viá»‡c truy xuáº¥t mapping khi lÆ°á»£ng groups quÃ¡ lá»›n.</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/elasticsearch/discord/discord-shard-mapping.jpg alt width=80% decoding=async></div><h4 id=222-shard-allocator>2.2.2. Shard Allocator</h4><p>CÃ¢u há»i Ä‘áº·t ra cho Discord lÃ  há» sáº½ thá»±c hiá»‡n mapping má»™t <strong>groupID</strong> vá»›i má»™t cáº·p <strong>Cluster - Index</strong> nhÆ° tháº¿ nÃ o? Cá»¥ thá»ƒ khi thá»±c hiá»‡n index má»™t <strong>groupID</strong>, Discord cáº§n dÃ¹ng tiÃªu chÃ­ nÃ o Ä‘á»ƒ chá»n ra má»™t cluster-index phÃ¹ há»£p.</p><p>CÃ¡ch mÃ  Discord giáº£i quyáº¿t cÃ¢u há»i nÃ y chÃ­nh lÃ  sá»­ dá»¥ng má»™t bá»™ <strong>Shard Allocator</strong> mÃ  á»Ÿ Ä‘Ã³, dá»±a trÃªn má»©c táº£i (load) trÃªn má»™t index (1 shard) Ä‘á»ƒ chá»n ra index cÃ³ má»©c load tá»‘i thiá»ƒu vÃ  á»•n Ä‘á»‹nh. Viá»‡c nÃ y khÃ¡ Ä‘Æ¡n giáº£n, sá»­ dá»¥ng má»™t bá»™ monitor há»£p lÃ½ cÃ¹ng vá»›i má»™t database hoáº·c má»™t service Ä‘Æ¡n giáº£n lÃ  cÃ³ thá»ƒ thá»±c hiá»‡n viá»‡c nÃ y.</p><p>Theo nhÆ° Discord chia sáº», há» sá»­ dá»¥ng Redis lÃ m nÆ¡i lÆ°u trá»¯ cÃ¡c metrics monitor Ä‘Æ°á»£c tá»« cÃ¡c clusters vÃ  indices, lÆ°u trá»¯ cÃ¡c metrics nÃ y theo <em>sortedset</em> nháº±m sáº¯p xáº¿p vÃ  truy xuáº¥t bá»™ (cluster-index) nhanh nháº¥t. ChÃºng ta cÃ³ thá»ƒ Æ°á»›c tÃ­nh lÆ°á»£ng keys trÃªn táº­p data nÃ y (hay lÆ°á»£ng indices thá»±c tháº¿ Ä‘Æ°á»£c sá»­ dá»¥ng) lÃ  Ä‘á»§ nhá» (tá»« vÃ i trÄƒm Ä‘áº¿n vÃ i chá»¥c ngÃ n tÃ¹y theo Ä‘á»™ lá»›n messages).</p><div class="center m-t-20 m-b-20"><img src=/img/post/elasticsearch/discord/discord-shard-allocator.jpg alt width=80% decoding=async></div><h3 id=23-search>2.3. Search</h3><p>NhÆ° váº­y Discord thá»±c hiá»‡n search nhÆ° tháº¿ nÃ o vá»›i cÃ¡ch thiáº¿t káº¿ nhÆ° mÃ¬nh Ä‘Ã£ Ä‘á» cáº­p?</p><p>Discord dá»±a trÃªn <em>groupID</em>, tá»©c <em>serverID</em>, dá»±a trÃªn bá»™ <em>Shard Mapping</em> Ä‘á»ƒ xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c <em>Cluster-Index</em> tÆ°Æ¡ng á»©ng. Dá»±a trÃªn keywords mÃ  ngÆ°á»i dÃ¹ng tÃ¬m kiáº¿m, Elasticsearch tráº£ vá» danh sÃ¡ch cÃ¡c <em>messageID</em> cÃ³ liÃªn quan Ä‘áº¿n tá»« khÃ³a. Discord dá»±a trÃªn <em>messageID</em> thá»±c hiá»‡n truy váº¥n sÃ¡ng database Ä‘á»ƒ láº¥y cÃ¡c thÃ´ng tin vÃ  tráº£ vá» cho client.</p><p>á» Ä‘Ã¢y cáº§n lÆ°u Ã½, Discord khÃ´ng thá»±c hiá»‡n lÆ°u trá»¯ cÃ¡c thÃ´ng tin khÃ¡c cá»§a messages trong Elasticsearch, mÃ  chá»‰ lÆ°u trá»¯ <code>messageID</code>, <code>serverID</code> vÃ  <code>channelID</code>. Bá»Ÿi vÃ¬ Discord khÃ´ng muá»‘n tá»‘n chi phÃ­ lÆ°u trá»¯ khi Ä‘Ã£ sá»­ dá»¥ng database khÃ¡c Ä‘á»ƒ lÆ°u trá»¯ nhá»¯ng messages nÃ y. Má»™t trade-off chÃºng ta nháº­n tháº¥y lÃ  viá»‡c truy xuáº¥t DB Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c thÃ´ng tin messages.</p><h3 id=24-cluster-size>2.4. Cluster Size</h3><p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sÃ³ thÃ´ng sá»‘ vá» lÆ°á»£ng lá»›n dá»¯ liá»‡u táº¡i Discord Ä‘Æ°á»£c lÆ°u trá»¯. ÄÃ¢y lÃ  nhá»¯ng thá»‘ng kÃª khÃ´ng chÃ­nh thá»©c mÃ  mÃ¬nh tÃ¬m Ä‘Æ°á»£c tá»« cÃ¡c nguá»“n khÃ¡c. Tuy nhiÃªn cÃ³ thá»ƒ tháº¥y Ä‘Æ°á»£c Ä‘á»™ lá»›n cá»§a dá»¯ liá»‡u cÅ©ng nhÆ° tÃ­nh á»•n Ä‘á»‹nh vÃ  hiá»‡u quáº£ mÃ  Elasticsearch Ä‘Æ°á»£c sá»­ dá»¥ng táº¡i Discord.</p><ul><li><p>NÄƒm 2017 trong 2 thÃ¡ng</p><ul><li><code>2</code> clusters</li><li><code>14</code> nodes</li><li><code>26 tá»·</code> documents</li><li><code>16k</code> indices</li><li>HÃ ng triá»‡u groups</li></ul></li><li><p>Giá»¯a 2018:</p><ul><li><code>~ 130m</code> groups</li><li><code>~ 530m</code> messages/day</li></ul></li><li><p>Giá»¯a 2020:</p><ul><li><code>~ 250m</code> groups</li><li><code>~ 963m</code> messages/day</li></ul></li></ul><h2 id=3-conclusion>3. Conclusion</h2><p>ÄÃ¢y lÃ  nhá»¯ng chia sáº» vá» cÃ¡ch mÃ  Discord sá»­ dá»¥ng Elasticsearch nhÆ° tháº¿ nÃ o mÃ  mÃ¬nh Ä‘Ã£ Ä‘á»c vÃ  hiá»ƒu Ä‘Æ°á»£c. CÃ³ thá»ƒ bÃ i viáº¿t chÆ°a thá»±c sá»± Ä‘áº§y Ä‘á»§ vÃ  hiá»ƒu Ä‘Æ°á»£c háº¿t nhá»¯ng <em>tinh hoa</em> bÃªn trong mÃ  Discord Ä‘á» cáº­p, nhÆ°ng mÃ¬nh nghÄ© Ä‘Ã¢y cÅ©ng lÃ  nhÆ°ng <em>bÃ i há»c Ä‘Ã¡ng quÃ½</em> cho nhá»¯ng ai Ä‘Ã£/Ä‘ang/sáº½ chuáº©n bá»‹ sá»­ dá»¥ng Elasticsearch cho má»™t á»©ng dá»¥ng chat (hoáº·c tÆ°Æ¡ng Ä‘á»“ng).</p><p>Äá»ƒ cÃ³ thá»ƒ hiá»ƒu rÃµ hÆ¡n vÃ  chi tiáº¿t hÆ¡n vá» nhá»¯ng chia sáº» tá»« Discord, vui lÃ²ng xem trong bÃ i blog <a href=https://blog.discord.com/how-discord-indexes-billions-of-messages-e3d5e9be866f>How Discord Indexes Billions of Messages</a>.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/elasticsearch/ rel=tag>Elasticsearch</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="Ha. Huynh Sam avatar" src=/img/avatar.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About Ha. Huynh Sam</span></div><div class=authorbox__description>HaHS's true identity is unknown. Maybe he is a successful blogger or writer. Nobody knows it. Do you know him? Let me know that ğŸ˜‰.</div></div><nav class="post-nav flex"><div class="post-nav__item post-nav__item--prev"><a class=post-nav__link href=/post/tutorial/elasticsearch/monitor-your-elasticsearch-cluster-with-grafana-and-prometheus/ rel=prev><span class=post-nav__caption>Â«&#8201;Previous</span><p class=post-nav__post-title>Monitor your Elasitcsearch Cluster with Grafana and Prometheus</p></a></div><div class="post-nav__item post-nav__item--next"><a class=post-nav__link href=/post/tutorial/network/tom-tat-su-khac-biet-giua-cac-version-cua-http-1.0-1.1-2.0/ rel=next><span class=post-nav__caption>Next&#8201;Â»</span><p class=post-nav__post-title>TÃ³m táº¯t sá»± khÃ¡c biá»‡t giá»¯a cÃ¡c version cá»§a HTTP 1.0, 1.1 vÃ  2.0</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"wearenodev"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><aside class=sidebar><div class="post__toc toc toc_sidebar m-t-30 m-b-50"><div class=toc__title>Table of contents</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#1-overview>1. Overview</a><ul><li><a href=#11-server--channel--message>1.1. Server / Channel / Message</a></li><li><a href=#12-database>1.2. Database</a></li></ul></li><li><a href=#2-how-discord-setup-elasticsearch>2. How Discord setup Elasticsearch?</a><ul><li><a href=#21-indexing>2.1. Indexing</a></li><li><a href=#22-discord-sharding>2.2. Discord Sharding</a></li><li><a href=#23-search>2.3. Search</a></li><li><a href=#24-cluster-size>2.4. Cluster Size</a></li></ul></li><li><a href=#3-conclusion>3. Conclusion</a></li></ul></nav></div></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/post/tutorial/security/tong-hop-top-10-loi-bao-mat-owasp-2017/>Tá»•ng há»£p top 10 lá»—i báº£o máº­t tá»« OWASP bÃ¡o cÃ¡o nÄƒm 2017</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/network/tom-tat-su-khac-biet-giua-cac-version-cua-http-1.0-1.1-2.0/>TÃ³m táº¯t sá»± khÃ¡c biá»‡t giá»¯a cÃ¡c version cá»§a HTTP 1.0, 1.1 vÃ  2.0</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/elasticsearch/discord-da-thiet-lap-elasticsearch-ntn-de-index-hang-ty-messages/>Discord Ä‘Ã£ thiáº¿t láº­p Elasticsearch nhÆ° tháº¿ nÃ o Ä‘á»ƒ cÃ³ thá»ƒ index hÃ ng tá»· messages?</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/elasticsearch/monitor-your-elasticsearch-cluster-with-grafana-and-prometheus/>Monitor your Elasitcsearch Cluster with Grafana and Prometheus</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/javascript/advance/vietnamese-search-in-datatables/>TÃ¬m kiáº¿m dá»¯ liá»‡u Tiáº¿ng Viá»‡t khÃ´ng dáº¥u trong DataTables</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/javascript/advance/remove-accents-in-vietnamese/>Chuyá»ƒn tá»« Tiáº¿ng Viá»‡t cÃ³ dáº¥u vá» chá»¯ cÃ¡i Latin trong JavaScript</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/cloud-tutorial/>Cloud Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/database-tutorial/>Database Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/elasticsearch-tutorial/>Elasticsearch Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/heroku-tutorial/>Heroku Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/java-tutorial/>Java Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/javascript-tutorial/>JavaScript Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/linux-tutorial/>Linux Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/network/>Network</a></li><li class=widget__item><a class=widget__link href=/categories/nodejs-tutorial/>NodeJS Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/security/>Security</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/adminlte2/ title=AdminLTE2>AdminLTE2 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/aws/ title=AWS>AWS (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/aws-ec2/ title="AWS - EC2">AWS - EC2 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cloud/ title=Cloud>Cloud (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/database/ title=Database>Database (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/elasticsearch/ title=Elasticsearch>Elasticsearch (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/elasticsearch-monitoring/ title="Elasticsearch Monitoring">Elasticsearch Monitoring (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/google-apis/ title="Google APIs">Google APIs (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/grafana/ title=Grafana>Grafana (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/heroku-deployment/ title="Heroku Deployment">Heroku Deployment (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/http/ title=HTTP>HTTP (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java/ title=Java>Java (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java-basic/ title="Java Basic">Java Basic (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java-thread/ title="Java Thread">Java Thread (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/javascript/ title=JavaScript>JavaScript (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/javascript-advance/ title="JavaScript Advance">JavaScript Advance (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/jsrmvi/ title=jsrmvi>jsrmvi (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/memcached/ title=Memcached>Memcached (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mongodb/ title=MongoDB>MongoDB (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mongoose/ title=Mongoose>Mongoose (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/network/ title=Network>Network (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nodejs/ title=NodeJS>NodeJS (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nodejs-advance/ title="NodeJS Advance">NodeJS Advance (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nodejs-deployment/ title="NodeJS Deployment">NodeJS Deployment (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/npm/ title=NPM>NPM (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/owasp/ title=OWASP>OWASP (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/pgadmin/ title=pgAdmin>pgAdmin (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/postgresql/ title=PostgreSQL>PostgreSQL (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/prometheus/ title=Prometheus>Prometheus (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/robomongo/ title=Robomongo>Robomongo (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/security/ title=Security>Security (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/sequelize/ title=Sequelize>Sequelize (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ubuntu/ title=Ubuntu>Ubuntu (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/vietnamese/ title=Vietnamese>Vietnamese (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/vietnamese-search/ title="Vietnamese Search">Vietnamese Search (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/webpack/ title=Webpack>Webpack (1)</a></div></div><span class="widget-social widget m-b-15"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-github" title=GitHub rel="noopener noreferrer" href=https://github.com/WeAreNoDev target=_blank><i class="fa fa-github-square"></i></a></span><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-twitter" title=Twitter rel="noopener noreferrer" href=https://twitter.com/huynhsamha target=_blank><i class="fa fa-twitter-square"></i></a></span><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-email" title=Email href=mailto:huynhsamha@gmail.com><i class="fa fa-envelope-square"></i></a></span><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-linkedin" title=LinkedIn rel="noopener noreferrer" href=https://linkedin.com/in/huynhsamha target=_blank><i class="fa fa-linkedin-square"></i></a></span></div></span></aside></div><footer class=footer><div class="container footer__container"><div class=footer__copyright>WeAreNoDev &copy; 2020<div><span class=footer__copyright-credits>Made with<i class="fa fa-heart m-l-5 m-r-5" style=color:#eb0025></i>by
<a href=https://github.com/huynhsamha target=_blank>Ha. Huynh Sam</a></span></div></div></div></footer></div><span id=scroll-top><i class="fa fa-caret-up"></i></span><script src=/vendor/jquery/3.5.1/jquery.min.js></script><script src=/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js></script><script type=text/javascript src=/js/main.min.f422027a0caaf9eadab59acbeb7e0d9a.js integrity="md5-9CICegyq+eratZrL634Nmg=="></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>