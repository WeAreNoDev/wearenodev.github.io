<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#ffffff"><title>Deploy Node.js with PostgreSQL to Heroku using Add-ons - We Are No Dev</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content="Heroku allows developers to deploy Node.js app with PostgreSQL database on their platform. This is simple tutorial for deploying a similar application using Node.js and PostgreSQL."><meta property="og:title" content="Deploy Node.js with PostgreSQL to Heroku using Add-ons"><meta property="og:description" content="Heroku allows developers to deploy Node.js app with PostgreSQL database on their platform. This is simple tutorial for deploying a similar application using Node.js and PostgreSQL."><meta property="og:type" content="article"><meta property="og:url" content="/post/tutorial/heroku/deploy-nodejs-with-postgresql-to-heroku-using-add-ons/"><meta property="article:published_time" content="2018-04-15T00:00:00+00:00"><meta property="article:modified_time" content="2018-04-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploy Node.js with PostgreSQL to Heroku using Add-ons"><meta name=twitter:description content="Heroku allows developers to deploy Node.js app with PostgreSQL database on their platform. This is simple tutorial for deploying a similar application using Node.js and PostgreSQL."><link rel=icon type=image/png href=/favicon.png><link rel=apple-touch-icon href=/favicon.png><meta name=msapplication-TileImage content="/favicon.png"><link href="https://fonts.googleapis.com/css2?family=Muli:ital,wght@0,400;0,500;0,700;0,800;1,400&display=swap" rel=stylesheet><link href=/vendor/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet><link rel=stylesheet href=/css/style.min.f697b2a4a9aa0869d746398a83b1a65f.css integrity="md5-9peypKmqCGnXRjmKg7GmXw=="><link rel=stylesheet href=/css/spacing_helpers.min.css><link rel=stylesheet href=/css/custom.css></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class=logo><a href=/ title="We Are No Dev" rel=home><img src=/favicon.png alt="We Are No Dev" class=header__favicon></a>
<a class=logo__link href=/ title="We Are No Dev" rel=home><div class=logo__title>We Are No Dev</div><div class=logo__tagline>We are NOT ONLY Developers</div></a><img src=/img/outline-banner.png alt="We Are No Dev" class=header__banner_img></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Deploy Node.js with PostgreSQL to Heroku using Add-ons</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2018-04-15T00:00:00Z>Apr 15, 2018</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/heroku-tutorial/ rel=category>Heroku Tutorial</a>, <a class=meta__link href=/categories/nodejs-tutorial/ rel=category>NodeJS Tutorial</a></span></div></div></header><div class="post__toc toc toc_mobile"><div class=toc__title>Table of contents</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#1-working-on-local-machine-with-nodejs-and-postgresql>1. Working on local machine with Node.js and PostgreSQL</a><ul><li><a href=#11-quickstart-nodejs-app-with-express>1.1. Quickstart Node.js app with express</a></li><li><a href=#12-environment-variables-in-nodejs-with-dotenv>1.2. Environment Variables in Node.js with dotenv</a></li><li><a href=#13-configure-postgresql-database>1.3. Configure PostgreSQL database</a></li><li><a href=#14-connect-nodejs-to-postgresql-using-sequelize>1.4. Connect Node.js to PostgreSQL using sequelize</a></li><li><a href=#15-create-database-models-with-sequelize>1.5. Create database models with sequelize</a></li><li><a href=#16-create-apis-for-models>1.6. Create APIs for models</a></li><li><a href=#17-create-scripts-for-database-drop-and-fake-data>1.7. Create scripts for database (drop and fake data)</a></li></ul></li><li><a href=#2-deploy-to-heroku-with-postgresql-cloud>2. Deploy to Heroku with PostgreSQL Cloud</a><ul><li><a href=#21-add-new-heroku-application>2.1. Add new Heroku application</a></li><li><a href=#22-add-ons-postgresql-database-on-heroku>2.2. Add-ons PostgreSQL database on Heroku</a></li><li><a href=#23-add-or-fake-database-on-postgresql-heroku>2.3. Add or fake database on PostgreSQL Heroku</a></li><li><a href=#24-open-heroku-app>2.4. Open Heroku App</a></li></ul></li><li><a href=#3-conclusion>3. Conclusion</a></li></ul></nav></div></div><div class="content post__content clearfix"><p><a href=https://www.heroku.com/>Heroku</a> allows developers to deploy <strong>Node.js</strong> app with <strong>PostgreSQL</strong> database on their platform. This is a simple tutorial for deploying a similar application using Node.js and PostgreSQL.</p><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku-postgre-node.png alt width=500px decoding=async></div><p>Before we begin the tutorial, I want to say about my OS. I&rsquo;m using <strong>Linux, Ubuntu 16.04</strong>.</p><p>This is my <a href=https://github.com/huynhsamha/tut-heroku-node-pg>repository</a> for the tutorial on <code>Github</code>.</p><h2 id=1-working-on-local-machine-with-nodejs-and-postgresql>1. Working on local machine with Node.js and PostgreSQL</h2><p>First, we should work with Node.js and PostgreSQL on <em>a local machine environment</em> before deploying onto Heroky.</p><h3 id=11-quickstart-nodejs-app-with-express>1.1. Quickstart Node.js app with express</h3><p><a href=https://expressjs.com/>Express</a> <em>is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications. We can use the package to create node.js app fastly.</em></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Create new directory</span>
mkdir tut-heroku-node-pg
cd tut-heroku-node-pg/

<span style=color:#75715e># Initialize node.js by Express with view engine is ejs</span>
express --ejs --git

<span style=color:#75715e># Install packages</span>
npm install
</code></pre></div><h3 id=12-environment-variables-in-nodejs-with-dotenv>1.2. Environment Variables in Node.js with dotenv</h3><p><a href=https://github.com/motdotla/dotenv>Dotenv</a> <em>is a zero-dependency module that loads environment variables from a <code>.env</code> file into <code>process.env</code>. To use environment variables for node.js app, use package <code>dotenv</code> and create file <code>.env</code> for app.</em></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm install dotenv --save
touch .env
</code></pre></div><ul><li>Open file <code>.env</code> and add lines formated <code>key=value</code> without spaces, example:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>SECRET_KEY<span style=color:#f92672>=</span>jwor9334bg5
</code></pre></div><ul><li>With <code>dotenv</code>, now we can access environment variables in file <code>.env</code> by <code>process.env.*</code>. To access effectively and accurately, we create file <code>config.js</code>.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>touch config.js
</code></pre></div><ul><li>In file <code>config.js</code>, we export environment variables to use by following lines:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>secretKey</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>SECRET_KEY</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;default secret key&#39;</span>
}
</code></pre></div><ul><li><p>We also have to configure package <code>dotenv</code> by require package in <code>app.js</code>.</p></li><li><p>At the top of file <code>app.js</code>, add the following lines</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// load environment variables in file .env to process.env.*
</span><span style=color:#75715e></span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;dotenv&#39;</span>).<span style=color:#a6e22e>config</span>();
</code></pre></div><h3 id=13-configure-postgresql-database>1.3. Configure PostgreSQL database</h3><p>Now, we&rsquo;ll create new PostgreSQL database at local to use. You can use <code>pgAdmin</code> (GUI application) to simplify the steps. In tutorial, I used <code>pgAdmin3</code></p><p><a href=https://www.pgadmin.org/>pgAdmin</a> <em>is the most popular and feature rich Open Source administration and development platform for PostgreSQL, the most advanced Open Source database in the world.</em></p><ul><li>Open <code>pgAdmin</code>. If you have existen user, you shouldn&rsquo;t create new user. To create new user, at <code>Login Roles</code> choose <code>New Login Role</code>. I created new user with username is <code>tutorial-heroku</code> and password is <code>12345</code></li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/create_user.png alt width decoding=async></div><ul><li>Create new database by choose <code>New Database</code> at <code>Databases</code> and create new. I created new database <code>tutorial-heroku-app</code> with owner is <code>tutorial-heroku</code></li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/create_database.png alt width decoding=async></div><ul><li><p>After having new database, we should get some database infomation. You can see host, port at GUI, my host and port is <code>localhost:5432</code></p></li><li><p>Open file <code>.env</code> to add the values:</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>DB_HOST<span style=color:#f92672>=</span>localhost
DB_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span>
DB_NAME<span style=color:#f92672>=</span>tutorial-heroku-app
DB_USERNAME<span style=color:#f92672>=</span>tutorial-heroku
DB_PASSWORD<span style=color:#f92672>=</span><span style=color:#ae81ff>12345</span>
</code></pre></div><ul><li>We should also export the values in file <code>config.js</code>:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>secretKey</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>SECRET_KEY</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;default secret key&#39;</span>,
    <span style=color:#a6e22e>db</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>dialect</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;postgres&#39;</span>,
        <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DB_HOST</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;localhost&#39;</span>,
        <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DB_PORT</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;5432&#39;</span>,
        <span style=color:#a6e22e>database</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DB_NAME</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;database&#39;</span>,
        <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DB_USERNAME</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;username&#39;</span>,
        <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DB_PASSWORD</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;password&#39;</span>
    }
}
</code></pre></div><h3 id=14-connect-nodejs-to-postgresql-using-sequelize>1.4. Connect Node.js to PostgreSQL using sequelize</h3><p><a href=http://docs.sequelizejs.com/>Sequelize</a> <em>is a promise-based ORM for Node.js v4 and up. It supports the dialects PostgreSQL, MySQL, SQLite and MSSQL and features solid transaction support, relations, read replication and more.</em></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm install --save pg pg-hstore sequelize
mkdir config
cd config
touch sequelize.js
</code></pre></div><ul><li>In file <code>config/sequelize.js</code>, we will create new instance of Sequelize and export the instance which is connected to database:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;sequelize&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../config&#39;</span>);

<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>database</span>, <span style=color:#a6e22e>username</span>, <span style=color:#a6e22e>password</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>db</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sequelize</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Sequelize</span>(
    <span style=color:#a6e22e>database</span>, <span style=color:#a6e22e>username</span>, <span style=color:#a6e22e>password</span>, <span style=color:#a6e22e>config</span>, { <span style=color:#a6e22e>timezone</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;+07:00&#39;</span> }
);

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sequelize</span>;
</code></pre></div><h3 id=15-create-database-models-with-sequelize>1.5. Create database models with sequelize</h3><ul><li>Run some commands for initialize models</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir models
touch index.js
touch user.js
touch post.js
</code></pre></div><ul><li>In file <code>user.js</code>, create new schema with sequelize:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;sequelize&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sequelize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../config/sequelize&#39;</span>);

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;User&#39;</span>, {
    <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
      <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
      <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
      <span style=color:#a6e22e>autoIncrement</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
      <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
    },
    <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> {
      <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>,
      <span style=color:#a6e22e>unique</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
    },
    <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>(<span style=color:#ae81ff>1024</span>) }
}, {
    <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;created_at&#39;</span>,
    <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;updated_at&#39;</span>,
    <span style=color:#a6e22e>timestamps</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
    <span style=color:#a6e22e>underscored</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
    <span style=color:#a6e22e>underscoredAll</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
});

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>User</span>;
</code></pre></div><ul><li>In file <code>post.js</code>, create new schema with sequelize:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;sequelize&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sequelize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../config/sequelize&#39;</span>);

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;Post&#39;</span>, {
    <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
      <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
      <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
      <span style=color:#a6e22e>autoIncrement</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
      <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
    },
    <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span> },
    <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span> },
    <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span> }
}, {
    <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;created_at&#39;</span>,
    <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;updated_at&#39;</span>,
    <span style=color:#a6e22e>timestamps</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
    <span style=color:#a6e22e>underscored</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
    <span style=color:#a6e22e>underscoredAll</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
});

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Post</span>;
</code></pre></div><ul><li>In file <code>index.js</code>, import schema models and add relationship between tables:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;sequelize&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sequelize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../config/sequelize&#39;</span>);

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./user&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./post&#39;</span>);

<span style=color:#75715e>/** Relationship between Entities */</span>
<span style=color:#a6e22e>User</span>.<span style=color:#a6e22e>hasMany</span>(<span style=color:#a6e22e>Post</span>, { <span style=color:#a6e22e>foreignKey</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user_id&#39;</span>, <span style=color:#a6e22e>as</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Posts&#39;</span> });
<span style=color:#a6e22e>Post</span>.<span style=color:#a6e22e>belongsTo</span>(<span style=color:#a6e22e>User</span>, { <span style=color:#a6e22e>foreignKey</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user_id&#39;</span>, <span style=color:#a6e22e>constraints</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>as</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user&#39;</span> });

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
    <span style=color:#a6e22e>sequelize</span>,
    <span style=color:#a6e22e>User</span>,
    <span style=color:#a6e22e>Post</span>
};
</code></pre></div><ul><li><p>Now we can require sequelize and auto create table and forign key.</p></li><li><p>In file <code>app.js</code>, add lines</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>sequelize</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./models&#39;</span>);

<span style=color:#75715e>/** Connect and config Database */</span>
<span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>sync</span>()
  .<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;PostgresSQL is sync&#39;</span>))
  .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>));
</code></pre></div><ul><li>Now run <code>npm start</code>, we will see</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/sequelize_sync.png alt width decoding=async></div><ul><li>Open <code>pgAdmin</code> and refresh, you can see 2 sequences, 2 tables with foreign key created auto</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/sequelize_auto.png alt width decoding=async></div><h3 id=16-create-apis-for-models>1.6. Create APIs for models</h3><ul><li><p>Create file <code>posts.js</code> in <code>routes</code>.</p></li><li><p>Edit file <code>routes/users.js</code> with:</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;express&#39;</span>);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>Router</span>();

<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>User</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../models&#39;</span>);

<span style=color:#75715e>/* GET users listing. */</span>
<span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) {
  <span style=color:#a6e22e>User</span>.<span style=color:#a6e22e>findAll</span>({ <span style=color:#a6e22e>attributes</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;password&#39;</span>] } })
    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>data</span> =&gt; <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>200</span>).<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>data</span>))
    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>500</span>).<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>err</span>))
});

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>router</span>;
</code></pre></div><ul><li>Edit file <code>routes/posts.js</code> with:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;express&#39;</span>);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>Router</span>();

<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>Post</span>, <span style=color:#a6e22e>User</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../models&#39;</span>);

<span style=color:#75715e>/* GET posts listing. */</span>
<span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) {
  <span style=color:#a6e22e>Post</span>.<span style=color:#a6e22e>findAll</span>({
    <span style=color:#a6e22e>include</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>model</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>User</span>, <span style=color:#a6e22e>as</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user&#39;</span> }]
  })
    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>data</span> =&gt; <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>200</span>).<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>data</span>))
    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>500</span>).<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>err</span>))
});

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>router</span>;
</code></pre></div><ul><li>Edit file <code>app.js</code> with:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./routes/index&#39;</span>);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./routes/users&#39;</span>);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./routes/posts&#39;</span>);

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#a6e22e>index</span>);
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/users&#39;</span>, <span style=color:#a6e22e>users</span>);
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/posts&#39;</span>, <span style=color:#a6e22e>posts</span>);
</code></pre></div><h3 id=17-create-scripts-for-database-drop-and-fake-data>1.7. Create scripts for database (drop and fake data)</h3><ul><li>To create or drop database quickly, you maybe add some <code>scripts</code>.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir scripts
cd scripts/
touch drop.js
touch fake.js
</code></pre></div><ul><li>In file <code>package.json</code>, add scripts</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;scripts&#34;</span>: {
        <span style=color:#f92672>&#34;start&#34;</span>: <span style=color:#e6db74>&#34;node ./bin/www&#34;</span>,
        <span style=color:#f92672>&#34;db:fake&#34;</span>: <span style=color:#e6db74>&#34;node scripts/fake&#34;</span>,
        <span style=color:#f92672>&#34;db:drop&#34;</span>: <span style=color:#e6db74>&#34;node scripts/drop&#34;</span>
    }
}
</code></pre></div><ul><li>Add package <code>async</code> to fake data simpler</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm install async --save
</code></pre></div><ul><li>In file <code>drop.js</code>, edit by</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;dotenv&#39;</span>).<span style=color:#a6e22e>config</span>();
<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>sequelize</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../models&#39;</span>);

<span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>drop</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Drop successully&#39;</span>); <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
}).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>); <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
})
</code></pre></div><ul><li>In file <code>fake.js</code>, edit by</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;dotenv&#39;</span>).<span style=color:#a6e22e>config</span>();
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>async</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;async&#39;</span>);
<span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>sequelize</span>, <span style=color:#a6e22e>User</span>, <span style=color:#a6e22e>Post</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;../models&#39;</span>);

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> [];
<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>15</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
  <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>push</span>({ <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;username_&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;password_&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span> });
}

<span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>sync</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
  <span style=color:#a6e22e>async</span>.<span style=color:#a6e22e>eachSeries</span>(<span style=color:#a6e22e>users</span>, (<span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>cb</span>) =&gt; {
    <span style=color:#a6e22e>User</span>.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>user</span>).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>user</span> =&gt; {
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> [];
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>num_posts</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>6</span>);
      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>num_posts</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
        <span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>push</span>({
          <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Post &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; of user &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>id</span>,
          <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;something here&#39;</span>,
          <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>id</span>
        });
      }
      <span style=color:#a6e22e>async</span>.<span style=color:#a6e22e>eachSeries</span>(<span style=color:#a6e22e>posts</span>, (<span style=color:#a6e22e>post</span>, <span style=color:#a6e22e>cb</span>) =&gt; {
        <span style=color:#a6e22e>Post</span>.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>post</span>).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>post</span> =&gt; <span style=color:#a6e22e>cb</span>()).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>err</span>));
      }, (<span style=color:#a6e22e>err</span>) =&gt; <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>err</span>))
    })
      .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>err</span>))
  }, (<span style=color:#a6e22e>err</span>) =&gt; {
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) {<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>); }
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Fake successfully&#39;</span>);
    <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
  });
})
  .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>err</span>))
</code></pre></div><ul><li>Now we can <code>fake</code> or <code>drop</code> data by run</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># for drop data</span>
npm run db:drop
<span style=color:#75715e># for fake data</span>
npm run db:fake
</code></pre></div><ul><li>Edit file <code>views/index.ejs</code> by add following lines</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>p</span>&gt;View list of users: &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/users&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span> <span style=color:#a6e22e>alt</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> &gt;}}/users&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
&lt;<span style=color:#f92672>p</span>&gt;View list of posts: &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/posts&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span> <span style=color:#a6e22e>alt</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> &gt;}}/posts&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
</code></pre></div><ul><li>Start server node.js and click 2 url in view to view your data, that will be:<ul><li><a href=http://localhost:3000/users>http://localhost:3000/users</a></li><li><a href=http://localhost:3000/posts>http://localhost:3000/posts</a></li></ul></li></ul><h2 id=2-deploy-to-heroku-with-postgresql-cloud>2. Deploy to Heroku with PostgreSQL Cloud</h2><p>Now we will use heroku to run our node.js, configure the postgresql database on heroku and deploy it.</p><h3 id=21-add-new-heroku-application>2.1. Add new Heroku application</h3><ul><li><p>Login or sign up new account on heroku.</p></li><li><p>Go to <a href=https://dashboard.heroku.com/apps>dashboard heroku</a> and create new app</p></li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_create_new_app_click.png alt width decoding=async></div><ul><li>Create new app. My app name is <code>tutorial-node-pg</code>, therefore, when you can&rsquo;t create new app with similar name, you shold choose another.</li></ul><p><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_create_new_app_modal.png alt width decoding=async></div><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_view_1.png alt width decoding=async></div><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_login.png alt width decoding=async></div></p><ul><li>Next, we will use git for local repository and remote to heroku</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>heroku login
<span style=color:#75715e># at your directory</span>
git init
heroku git:remote -a tutorial-node-pg
<span style=color:#75715e># tutorial-node-pg should you app name</span>
</code></pre></div><ul><li>Now, we can use git to deploy to heroku by commit and push. Because your local directory is remote to heroku, so in file <code>.gitignore</code>, you don&rsquo;t need ignore file <code>.env</code> to deploy environment variables to heroku. Therefore, check your file <code>.gitignore</code>, if it has line <code>.env</code>, you should comment that line before push to heroku. But currently we will not push to heroku because we will configure postgre data on heroku with following instructions</li></ul><h3 id=22-add-ons-postgresql-database-on-heroku>2.2. Add-ons PostgreSQL database on Heroku</h3><ul><li>On heroku, choose tab <code>Resources</code>, in <code>Add-ons</code>, search <code>Postgre</code></li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_addons_search.png alt width decoding=async></div><ul><li><p>Click to <code>Heroku Postgre</code> option, one pop-up will appear and choose <code>Plan name</code> is <code>Hobby Dev - Free</code> for free.</p></li><li><p>Now heroku has created new database postgreSQL and connect it to you heroku app. You can checkout <a href=https://data.heroku.com/>https://data.heroku.com/</a> by options on your top-right menu to view your database</p></li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_menu_data.png alt width decoding=async></div><ul><li>At your data heroku page, click to your database to view details</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_data_page.png alt width decoding=async></div><ul><li>Choose tab <code>Settings</code> and click to <code>View Credentials</code></li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_credentials.png alt width decoding=async></div><ul><li>Now we can copy database credentials and change values in file <code>.env</code> in local machine.</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_credentials_2.png alt width decoding=async></div><ul><li>Now we can deploy to heroku app by using git commands</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># view changes</span>
git status

<span style=color:#75715e># add all changes</span>
git add -A

git commit -m <span style=color:#e6db74>&#34;deploy new app&#34;</span>
<span style=color:#75715e># push to remote heroku, branch master</span>
git push heroku master
</code></pre></div><ul><li>After commit and push to heroku, heroku auto build packages and start your server node.js. After build successfully, you can view your web herokuapp on your browser by</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>heroku open
</code></pre></div><p>You can see</p><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_page_1.png alt width decoding=async></div><ul><li>When click <code>/users</code> or <code>/posts</code>, you can&rsquo;t see anything, because your database on heroku don&rsquo;t have any. You should add or fake some in your cloud. Now I will do that in following section.</li></ul><h3 id=23-add-or-fake-database-on-postgresql-heroku>2.3. Add or fake database on PostgreSQL Heroku</h3><p>You have 2 choices, that is directly on cloud, or run on local and deploy to cloud</p><h4 id=231-option-1-directly-on-cloud>2.3.1. Option 1: Directly on cloud</h4><p>Simply, you can run <code>npm run db:fake</code>, but I don&rsquo;t recommend you do so, because it can not control your data on heroku. The best thing you should do is the 2nd one below I will say.</p><h4 id=232-option-2-remote-database-postgresql-to-local>2.3.2. Option 2: Remote database PostgreSQL to local</h4><p>You can see <a href=https://devcenter.heroku.com/articles/heroku-postgresql#pg-push-and-pg-pull>intructions here</a> or do what I instructed next</p><h5 id=2321-pull-database-postgre-from-heroku-to-local>2.3.2.1. Pull database postgre from heroku to local</h5><ul><li>Open terminal at root project and run</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>heroku pg:pull DATABASE_URL heroku_node_pg_local --app tutorial-node-pg
</code></pre></div><p>with:</p><ul><li><code>DATABASE_URL</code>: default value for your database</li><li><code>heroku_node_pg_local</code>: name databse on your local machine</li><li><code>tutorial-node-pg</code>: name application on heroku</li></ul><h5 id=2322-fake-data-on-local-machine>2.3.2.2. Fake data on local machine</h5><p>Open <code>pgAdmin</code> to view your database. Now you can import database by scripts directly on local, or do the other way as:</p><ul><li>Open file <code>.env</code> and change your database credentials (comment and add new lines):</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>DB_HOST<span style=color:#f92672>=</span>localhost
DB_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span>
DB_NAME<span style=color:#f92672>=</span>heroku_node_pg_local
DB_USERNAME<span style=color:#f92672>=</span>tutorial-heroku
DB_PASSWORD<span style=color:#f92672>=</span><span style=color:#ae81ff>12345</span>
</code></pre></div><ul><li>Now faking data is secure and controllable</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm run db:fake
</code></pre></div><ul><li>Your current cloud data will not have any data, because the current data is local, checked and you still do not see any data</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>heroku open
</code></pre></div><h5 id=2323-push-database-postgre-from-local-to-heroku-cloud>2.3.2.3. Push database postgre from local to heroku cloud</h5><ul><li>Change file <code>.env</code> by uncomment old lines (heroku cloud) and comment new lines (local)</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>heroku pg:reset
heroku pg:push heroku_node_pg_local DATABASE_URL --app tutorial-node-pg
</code></pre></div><h3 id=24-open-heroku-app>2.4. Open Heroku App</h3><p>Fine! Now we can view our achievement. Open <a href=https://data.heroku.com>https://data.heroku.com</a> you will see data available</p><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/heroku_data_all.png alt width decoding=async></div><p>Open <code>herokuapp</code>, you can see data also available</p><ul><li>This <code>/users</code>:</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/app_users.png alt width decoding=async></div><ul><li>This is <code>/posts</code>:</li></ul><div class="center m-t-20 m-b-20"><img src=/img/post/heroku-node-pg/app_posts.png alt width decoding=async></div><h2 id=3-conclusion>3. Conclusion</h2><p>I have shown you how to deploy a node.js app to heroku with the postgresql database, which uses some packages like express, sequelize, dotenv, pgadmin. You can see my source code for example on this <a href=https://github.com/huynhsamha/tut-heroku-node-pg>Github Repository</a>.</p><p>Thanks for reading my article! If you have any feedback or criticism, feel free to leave any comment!</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/heroku-deployment/ rel=tag>Heroku Deployment</a></li><li class=tags__item><a class="tags__link btn" href=/tags/nodejs-deployment/ rel=tag>NodeJS Deployment</a></li><li class=tags__item><a class="tags__link btn" href=/tags/nodejs/ rel=tag>NodeJS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/postgresql/ rel=tag>PostgreSQL</a></li><li class=tags__item><a class="tags__link btn" href=/tags/sequelize/ rel=tag>Sequelize</a></li><li class=tags__item><a class="tags__link btn" href=/tags/pgadmin/ rel=tag>pgAdmin</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="Ha. Huynh Sam avatar" src=/img/avatar.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About Ha. Huynh Sam</span></div><div class=authorbox__description>HaHS's true identity is unknown. Maybe he is a successful blogger or writer. Nobody knows it. Do you know him? Let me know that .</div></div><nav class="post-nav flex"><div class="post-nav__item post-nav__item--prev"><a class=post-nav__link href=/post/tutorial/heroku/deploy-nodejs-with-mongodb-to-heroku-using-mlab/ rel=prev><span class=post-nav__caption>&#8201;Previous</span><p class=post-nav__post-title>Deploy Node.js with MongoDB to Heroku using mLab</p></a></div><div class="post-nav__item post-nav__item--next"><a class=post-nav__link href=/post/tutorial/nodejs/advance/custom-search-engine-in-nodejs-with-google-api/ rel=next><span class=post-nav__caption>Next&#8201;</span><p class=post-nav__post-title>How to Use Custom Search Engine (CSE) in Node.js with Google API?</p></a></div></nav></div><aside class=sidebar><div class="post__toc toc toc_sidebar m-t-30 m-b-50"><div class=toc__title>Table of contents</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#1-working-on-local-machine-with-nodejs-and-postgresql>1. Working on local machine with Node.js and PostgreSQL</a><ul><li><a href=#11-quickstart-nodejs-app-with-express>1.1. Quickstart Node.js app with express</a></li><li><a href=#12-environment-variables-in-nodejs-with-dotenv>1.2. Environment Variables in Node.js with dotenv</a></li><li><a href=#13-configure-postgresql-database>1.3. Configure PostgreSQL database</a></li><li><a href=#14-connect-nodejs-to-postgresql-using-sequelize>1.4. Connect Node.js to PostgreSQL using sequelize</a></li><li><a href=#15-create-database-models-with-sequelize>1.5. Create database models with sequelize</a></li><li><a href=#16-create-apis-for-models>1.6. Create APIs for models</a></li><li><a href=#17-create-scripts-for-database-drop-and-fake-data>1.7. Create scripts for database (drop and fake data)</a></li></ul></li><li><a href=#2-deploy-to-heroku-with-postgresql-cloud>2. Deploy to Heroku with PostgreSQL Cloud</a><ul><li><a href=#21-add-new-heroku-application>2.1. Add new Heroku application</a></li><li><a href=#22-add-ons-postgresql-database-on-heroku>2.2. Add-ons PostgreSQL database on Heroku</a></li><li><a href=#23-add-or-fake-database-on-postgresql-heroku>2.3. Add or fake database on PostgreSQL Heroku</a></li><li><a href=#24-open-heroku-app>2.4. Open Heroku App</a></li></ul></li><li><a href=#3-conclusion>3. Conclusion</a></li></ul></nav></div></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/post/tutorial/java/basic/thread/thread-pooled-server-trong-java/>Thread Pooled Server trong Java</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/java/basic/thread/multithreaded-server-trong-java/>Multithreaded Server trong Java</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/java/basic/thread/singlethreaded-server-trong-java/>Singlethreaded Server trong Java</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/database/memcached-la-gi-va-cach-luu-tru-trong-memcached/>Memcached l g? Cch lu tr trong Memcacheds</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/cloud/launch-amazon-ec2-instance-with-aws-free-tier-ubuntu-server-18/>Launch Amazon EC2 Instance with AWS Free Tier - Ubuntu Server 18.04 LTS</a></li><li class=widget__item><a class=widget__link href=/post/tutorial/nodejs/advance/how-to-use-es7-import-export-and-async-await-nodejs/>How to Use ES7 Import/Export, Async/Await in Node.js?</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/cloud-tutorial/>Cloud Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/database-tutorial/>Database Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/heroku-tutorial/>Heroku Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/java-tutorial/>Java Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/linux-tutorial/>Linux Tutorial</a></li><li class=widget__item><a class=widget__link href=/categories/nodejs-tutorial/>NodeJS Tutorial</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/aws/ title=AWS>AWS (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/aws-ec2/ title="AWS - EC2">AWS - EC2 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cloud/ title=Cloud>Cloud (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/database/ title=Database>Database (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/google-apis/ title="Google APIs">Google APIs (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/heroku-deployment/ title="Heroku Deployment">Heroku Deployment (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java/ title=Java>Java (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java-basic/ title="Java Basic">Java Basic (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java-thread/ title="Java Thread">Java Thread (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/memcached/ title=Memcached>Memcached (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mongodb/ title=MongoDB>MongoDB (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mongoose/ title=Mongoose>Mongoose (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nodejs/ title=NodeJS>NodeJS (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nodejs-advance/ title="NodeJS Advance">NodeJS Advance (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nodejs-deployment/ title="NodeJS Deployment">NodeJS Deployment (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/pgadmin/ title=pgAdmin>pgAdmin (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/postgresql/ title=PostgreSQL>PostgreSQL (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/robomongo/ title=Robomongo>Robomongo (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/sequelize/ title=Sequelize>Sequelize (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ubuntu/ title=Ubuntu>Ubuntu (1)</a></div></div><span class="widget-social widget m-b-15"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-github" title=GitHub rel="noopener noreferrer" href=https://github.com/WeAreNoDev target=_blank><i class="fa fa-github-square"></i></a></span><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-twitter" title=Twitter rel="noopener noreferrer" href=https://twitter.com/huynhsamha target=_blank><i class="fa fa-twitter-square"></i></a></span><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-email" title=Email href=mailto:huynhsamha@gmail.com><i class="fa fa-envelope-square"></i></a></span><span class="widget-social__item widget__item"><a class="widget-social__link widget__link btn btn-social-linkedin" title=LinkedIn rel="noopener noreferrer" href=https://linkedin.com/in/huynhsamha target=_blank><i class="fa fa-linkedin-square"></i></a></span></div></span></aside></div><footer class=footer><div class="container footer__container"><div class=footer__copyright>WeAreNoDev &copy; 2020<div><span class=footer__copyright-credits>Made with<i class="fa fa-heart m-l-5 m-r-5" style=color:#eb0025></i>by
<a href=https://github.com/huynhsamha target=_blank>Ha. Huynh Sam</a></span></div></div></div></footer></div><script type=text/javascript src=/js/menu.min.f829e662179f8ddc402f702fdfcf8572.js integrity="md5-+CnmYhefjdxAL3Av38+Fcg=="></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>